sap.ui.define(["sap/fe/core/PageController","sap/m/MessageBox","sap/ui/core/Fragment"],function(e,t,n){"use strict";return e.extend("manager.ext.main.Main",{onInit:function(){const e=new sap.ui.model.json.JSONModel({pages:[{text:"Calculate Schemes",key:"idPageCalculate",icon:"sap-icon://simulate"}]});this.getView().setModel(e,"localModel")},onCalculationRun:function(e){const a=e.getSource().getBindingContext().getPath(),o=this.getAppComponent().getModel(),s=this.getView().getModel("localModel"),i=o.getServiceUrl(),c=this.getView(),r=this;c.setBusy(true);if(!this._oCalculatePopUp){this._oCalculatePopUp=n.load({id:c.getId(),name:"manager.ext.fragment.CalculatePopup",controller:this}).then(function(e){c.addDependent(e);return e})}$.get(i.slice(0,-1)+a,function(e){const n={schemeid:e.schemeid,schemename:e.schemename,skuid:e.skuid,regioncode:e.regioncode,empcode:e.empcode,minsales:e.minsales,percentile:e.percentile,from_date:e.from_date,to_date:e.to_date,icid:e.ICID};$.ajax({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:i+"calculatedata",data:JSON.stringify(n),success:function(e){c.setBusy(false);const n=/\d/g,a=e=>((e||"").match(n)||"").join("");if(!e){t.warning("There no data for this scheme.");return}s.setProperty("/SalesTransData",e.value.SalesTransData.sort(function(e,t){const n=Number(a(e.SALES_AGENT))-Number(a(t.SALES_AGENT));if(n!==0){return n}const o=new Date(e.SALE_DATE||0);const s=new Date(t.SALE_DATE||0);return o.getTime()-s.getTime()}));r._oCalculatePopUp.then(e=>e.open())},error:function(){c.setBusy(false)}})})},onCalculatePopClose:function(){this._oCalculatePopUp.then(e=>e.close())},onDateFormatter:function(e){if(!e)return"";const t=new Date(e),n=new Date(t.getTime()+t.getTimezoneOffset()*6e4);return sap.ui.core.format.DateFormat.getDateInstance({pattern:"dd MMM, yyyy"}).format(n)}})});
//# sourceMappingURL=Main.controller.js.map