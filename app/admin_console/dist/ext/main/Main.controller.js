sap.ui.define(["sap/fe/core/PageController","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/m/MessageToast","sap/m/MessageBox"],function(e,t,n,o,i){"use strict";return e.extend("adminconsole.ext.main.Main",{onInit:function(){const e=new t({min:0,max:100,pages:[{text:"Incentive",key:"idPageIncentive",icon:"sap-icon://employee"},{text:"Calculate Schemes",key:"idPageCalculate",icon:"sap-icon://simulate"}],calculate:{to_date:"",from_date:"",to_date_min_date:new Date}});this.getView().setModel(e,"localModel")},onAfterRendering:function(){this.onFetchMasterData()},onFetchMasterData:function(){const e=this.getView().getModel(),t=this.getView().getModel("localModel"),n=e.getServiceUrl();$.get(n+"SkuCode",function(e){const n=e.value;t.setProperty("/SkuCode",n)});$.get(n+"Region",function(e){const n=e.value;t.setProperty("/Region",n)});$.get(n+"OrgData",function(e){const n=e.value;t.setProperty("/OrgData",n)})},onPressIncentiveAddMoreOpen:function(){const e=this.getView(),t=e.getModel("localModel");if(!this._oIncentive){this._oIncentive=n.load({id:e.getId(),name:"adminconsole.ext.fragments.AddMoreIncentive",controller:this}).then(function(t){e.addDependent(t);return t})}return this._oIncentive.then(function(e){e.open();t.setProperty("/incentive",{schemename:"",skuid:"",regioncode:"",empcode:"",minsales:0,percentile:0})})},onIncentiveTablePress:function(e){const t=e.getSource().getBindingContext().getObject(),n=this.getView().getModel("localModel");this.onPressIncentiveAddMoreOpen().then(function(){n.setProperty("/incentive",t)})},onIncentiveSubmit:function(){const e=this.getAppComponent().getModel(),t=e.getServiceUrl(),n=this.getView().getModel("localModel"),o=n.getProperty("/incentive"),c=this.getView().byId("idIncentiveTable"),s=this;$.ajax({type:o.ID?"PATCH":"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:t+(o.ID?"Insentive(ID="+o.ID+",IID="+o.IID+")":"Insentive"),data:JSON.stringify(o),success:function(){i.success("Incentive Added Successfully",{onClose:function(){c.getBindingInfo("items").binding.refresh();s.onPressIncentiveAddMoreClose()}})},error:console.error})},onPressIncentiveAddMoreClose:function(){this._oIncentive.then(function(e){e.close()})},onPercentageChange:function(e){const t=e.getSource().getValue();if(t>100||t<0){o.show("Percentage should be between 0 and 100",{duration:3e3,position:"center"});e.getSource().setValue(0)}},onItemSelect:function(e){const t=e.getParameter("item");this.byId("idNavContainer").to(this.getView().createId(t.getKey()))},onIncentiveCalSelect:function(e){const t=e.getParameter("selectedItem").getBindingContext().getObject(),n=this.getAppComponent().getModel(),o=n.getServiceUrl(),i=this.getView().getModel("localModel"),c=i.getProperty("/calculate");$.get(o+"Insentive(IID="+t.IID+",ID="+t.ID+")",function(e){i.setProperty("/calculate",{schemeid:c.schemeid,schemename:c.schemename,skuid:e.skuid,regioncode:e.regioncode,empcode:e.empcode,minsales:e.minsales,percentile:e.percentile,to_date:"",from_date:"",to_date_min_date:new Date})})},onCalculateFromDateChange:function(e){const t=this.getView().getModel("localModel");if(e.getSource().getValue())t.setProperty("/calculate/to_date_min_date",new Date(e.getSource().getValue()))},onCalculationSubmit:function(e){const t=this.getView().getModel("localModel"),n=JSON.parse(JSON.stringify(t.getProperty("/calculate"))),o=this.getAppComponent().getModel(),c=o.getServiceUrl(),s=this.getView().byId("idCalculationTable");delete n["to_date_min_date"];$.ajax({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:c+"InsentiveRanFor",data:JSON.stringify(n),success:function(e){i.success("Incentive Calculation Added Successfully!",{onClose:function(){s.getBindingInfo("items").binding.refresh();t.setProperty("/calculate",{})}})},error:console.error})},_onFormatRegion:function(e){if(!e)return"";const t=this.getView().getModel("localModel"),n=t.getProperty("/Region");if(!n)return"";const o=n.find(t=>t.region_code===e);if(o){return o.Region_name}return""},_onFormatOrg:function(e){if(!e)return"";const t=this.getView().getModel("localModel"),n=t.getProperty("/OrgData");if(!n)return"";const o=n.find(t=>t.empcode===e);if(o){return o["function"]}return""},_onFormatSKU:function(e){if(!e)return"";const t=this.getView().getModel("localModel"),n=t.getProperty("/SkuCode");if(!n)return"";const o=n.find(t=>t.skucode===e);if(o){return o.sku_name}return""}})});
//# sourceMappingURL=Main.controller.js.map